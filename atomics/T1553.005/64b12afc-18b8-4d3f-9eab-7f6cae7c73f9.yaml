api_version: "2.0"
name: Remove the Zone.Identifier alternate data stream
description: |
    Remove the Zone.Identifier alternate data stream which identifies the file as downloaded from the internet.
    Removing this allows more freedom in executing scripts in PowerShell and avoids opening files in protected view.
args:
    - name: file_path
      type: string
      default: $env:tmp\ReadMe.md
    - name: file_to_download
      type: url
      default: https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/README.md
uuid: 64b12afc-18b8-4d3f-9eab-7f6cae7c73f9
mitre:
    tactics:
        - 'TA0005: Defense Evasion'
    techniques:
        - 'T1553: Subvert Trust Controls'
    subtechniques:
        - 'T1553.005: Mark-of-the-Web Bypass'
requirements:
    platforms:
        - os: windows
steps:
    - name: remove-the-zone.identifier-alternate-data-stream
      inline: |
        Unblock-File -Path {{.Args.file_path}}
      executor: powershell
      cleanup:
        inline: |
            Set-Content -Path {{.Args.file_path}} -Stream Zone.Identifier -Value '[ZoneTransfer]','ZoneId=3'
        executor: powershell
