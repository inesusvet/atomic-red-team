api_version: "2.0"
name: Store file in Alternate Data Stream (ADS)
description: |
    Storing files in Alternate Data Stream (ADS) similar to Astaroth malware.
    Upon execution cmd will run and attempt to launch desktop.ini. No windows remain open after the test
args:
    - name: payload_path
      type: path
      default: c:\windows\system32\cmd.exe
    - name: ads_file_path
      type: path
      default: C:\Users\Public\Libraries\yanki\desktop.ini
    - name: ads_name
      type: string
      default: desktop.ini
uuid: 2ab75061-f5d5-4c1a-b666-ba2a50df5b02
mitre:
    tactics:
        - 'TA0005: Defense Evasion'
    techniques:
        - 'T1564: Hide Artifacts'
    subtechniques:
        - 'T1564.004: NTFS File Attributes'
requirements:
    platforms:
        - os: windows
steps:
    - name: store-file-in-alternate-data-stream-(ads)
      inline: |
        if (!(Test-Path C:\Users\Public\Libraries\yanki -PathType Container)) {
            New-Item -ItemType Directory -Force -Path C:\Users\Public\Libraries\yanki
            }
        Start-Process -FilePath "$env:comspec" -ArgumentList "/c,type,{{.Args.payload_path}},>,`"{{.Args.ads_file_path}}:{{.Args.ads_name}}`""
      executor: powershell
      cleanup:
        inline: |
            Remove-Item "{{.Args.ads_file_path}}" -Force -ErrorAction Ignore
        executor: powershell
