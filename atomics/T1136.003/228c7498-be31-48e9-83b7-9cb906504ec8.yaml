api_version: "2.0"
name: Azure AD - Create a new user via Azure CLI
description: Creates a new user in Azure AD via the Azure CLI. Upon successful creation, a new user will be created. Adversaries create new users so that their malicious activity does not interrupt the normal functions of the compromised users and can remain undetected for a long time.
args:
    - name: username
      type: string
      default: atomicredteam
    - name: userprincipalname
      type: string
      default: atomicredteam@yourdomain.com
    - name: password
      type: string
      default: reallylongcredential12345ART-ydsfghsdgfhsdgfhgsdhfg
uuid: 228c7498-be31-48e9-83b7-9cb906504ec8
mitre:
    tactics:
        - 'TA0003: Persistence'
    techniques:
        - 'T1136: Create Account'
    subtechniques:
        - 'T1136.003: Cloud Account'
requirements:
    platforms:
        - os: azure-ad
steps:
    - name: Check if Azure CLI is installed and install manually
      inline: az account list
      executor: powershell
    - name: Check if Azure CLI is installed and install via PowerShell
      inline: az account list
      executor: powershell
    - name: Update the userprincipalname to meet your requirements
      inline: Update the input arguments so the userprincipalname value is accurate for your environment
      executor: powershell
    - name: azure-ad---create-a-new-user-via-azure-cli
      inline: "az login\n$userprincipalname = \"{{.Args.userprincipalname}}\"\n$username = \"{{.Args.username}}\"      \n$password = \"{{.Args.password}}\"\naz ad user create --display-name $username --password $password --user-principal-name $userprincipalname\naz ad user list --filter \"displayname eq 'atomicredteam'\"     "
      executor: powershell
      cleanup:
        inline: az ad user delete --id
        executor: powershell
