api_version: "2.0"
name: Reg Key Run
description: "Run Key Persistence\n\nUpon successful execution, cmd.exe will modify the registry by adding \\\"Atomic Red Team\\\" to the Run key. Output will be via stdout. \n"
args:
    - name: command_to_execute
      type: path
      default: C:\Path\AtomicRedTeam.exe
uuid: e55be3fd-3521-4610-9d1a-e210e42dcf05
mitre:
    tactics:
        - 'TA0003: Persistence'
        - 'TA0004: Privilege Escalation'
    techniques:
        - 'T1547: Boot or Logon Autostart Execution'
    subtechniques:
        - 'T1547.001: Registry Run Keys / Startup Folder'
requirements:
    platforms:
        - os: windows
steps:
    - name: reg-key-run
      inline: |
        REG ADD "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /V "Atomic Red Team" /t REG_SZ /F /D "{{.Args.command_to_execute}}"
      executor: command_prompt
      cleanup:
        inline: |
            REG DELETE "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /V "Atomic Red Team" /f >nul 2>&1
        executor: command_prompt
