api_version: "2.0"
name: Reg Key RunOnce
description: "RunOnce Key Persistence.\n\nUpon successful execution, cmd.exe will modify the registry to load AtomicRedTeam.dll to RunOnceEx. Output will be via stdout. \n"
args:
    - name: thing_to_execute
      type: path
      default: C:\Path\AtomicRedTeam.dll
uuid: 554cbd88-cde1-4b56-8168-0be552eed9eb
mitre:
    tactics:
        - 'TA0003: Persistence'
        - 'TA0004: Privilege Escalation'
    techniques:
        - 'T1547: Boot or Logon Autostart Execution'
    subtechniques:
        - 'T1547.001: Registry Run Keys / Startup Folder'
requirements:
    platforms:
        - os: windows
steps:
    - name: reg-key-runonce
      inline: |
        REG ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnceEx\0001\Depend /v 1 /d "{{.Args.thing_to_execute}}"
      executor: command_prompt
      cleanup:
        inline: |
            REG DELETE HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnceEx\0001\Depend /v 1 /f >nul 2>&1
        executor: command_prompt
