api_version: "2.0"
name: secedit used to create a Run key in the HKLM Hive
description: |
    secedit allows to manipulate the HKLM hive of the Windows registry. This test creates a Run key with the keyname calc having calc.exe as the value in the HKLM hive.
    [Reference](https://blueteamops.medium.com/secedit-and-i-know-it-595056dee53d)
args:
    - name: secedit_db
      type: string
      default: mytemplate.db
    - name: ini_file
      type: string
      default: $PathToAtomicsFolder\T1547.001\src\regtemplate.ini
uuid: 14fdc3f1-6fc3-4556-8d36-aa89d9d42d02
mitre:
    tactics:
        - 'TA0003: Persistence'
        - 'TA0004: Privilege Escalation'
    techniques:
        - 'T1547: Boot or Logon Autostart Execution'
    subtechniques:
        - 'T1547.001: Registry Run Keys / Startup Folder'
requirements:
    platforms:
        - os: windows
steps:
    - name: secedit-used-to-create-a-run-key-in-the-hklm-hive
      inline: |
        secedit /import /db {{.Args.secedit_db}} /cfg "{{.Args.ini_file}}"
        secedit /configure /db {{.Args.secedit_db}}
      executor: command_prompt
      cleanup:
        inline: REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /V "calc" /f >nul 2>&1
        executor: command_prompt
