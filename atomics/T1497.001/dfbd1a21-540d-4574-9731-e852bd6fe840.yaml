api_version: "2.0"
name: Detect Virtualization Environment (Linux)
description: |
    systemd-detect-virt detects execution in a virtualized environment.
    At boot, dmesg stores a log if a hypervisor is detected.
uuid: dfbd1a21-540d-4574-9731-e852bd6fe840
mitre:
    tactics:
        - 'TA0005: Defense Evasion'
        - 'TA0007: Discovery'
    techniques:
        - 'T1497: Virtualization/Sandbox Evasion'
    subtechniques:
        - 'T1497.001: System Checks'
requirements:
    platforms:
        - os: linux
steps:
    - name: detect-virtualization-environment-(linux)
      inline: |
        if (systemd-detect-virt) then echo "Virtualization Environment detected"; fi;
        if (sudo dmidecode | egrep -i 'manufacturer|product|vendor' | grep -iE 'Oracle|VirtualBox|VMWare|Parallels') then echo "Virtualization Environment detected"; fi;
      executor: sh
      cleanup:
        inline: ""
        executor: sh
