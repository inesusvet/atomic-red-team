api_version: "2.0"
name: Detect Virtualization Environment (Windows)
description: |
    Windows Management Instrumentation(WMI) objects contains system information which helps to detect virtualization. This command will specifically attempt to get the CurrentTemperature value from this object and will check to see if the attempt results in an error that contains the word supported. This is meant to find the result of Not supported, which is the result if run in a virtual machine
uuid: 502a7dc4-9d6f-4d28-abf2-f0e84692562d
mitre:
    tactics:
        - 'TA0005: Defense Evasion'
        - 'TA0007: Discovery'
    techniques:
        - 'T1497: Virtualization/Sandbox Evasion'
    subtechniques:
        - 'T1497.001: System Checks'
requirements:
    platforms:
        - os: windows
steps:
    - name: detect-virtualization-environment-(windows)
      inline: |
        $error.clear()
        Get-WmiObject -Query "SELECT * FROM MSAcpi_ThermalZoneTemperature" -ErrorAction SilentlyContinue
        if($error) {echo "Virtualization Environment detected"}
      executor: powershell
      cleanup:
        inline: |
            $error.clear()
        executor: powershell
