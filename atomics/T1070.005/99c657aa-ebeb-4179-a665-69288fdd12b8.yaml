api_version: "2.0"
name: Disable Administrative Share Creation at Startup
description: "Administrative shares are hidden network shares created by Microsoftâ€™s Windows NT operating systems that grant system administrators \nremote access to every disk volume on a network-connected system. These shares are automatically created at started unless they have been\npurposefully disabled as is done in this Atomic test. As Microsoft puts it, \"Missing administrative shares typically \nindicate that the computer in question has been compromised by malicious software.\"\nhttps://threatpost.com/conti-ransomware-gang-has-full-log4shell-attack-chain/177173/\n"
uuid: 99c657aa-ebeb-4179-a665-69288fdd12b8
mitre:
    tactics:
        - 'TA0005: Defense Evasion'
    techniques:
        - 'T1070: Indicator Removal'
    subtechniques:
        - 'T1070.005: Network Share Connection Removal'
requirements:
    platforms:
        - os: windows
steps:
    - name: disable-administrative-share-creation-at-startup
      inline: |
        reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v AutoShareServer /t REG_DWORD /d 0 /f
        reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v AutoShareWks /t REG_DWORD /d 0 /f
      executor: command_prompt
      cleanup:
        inline: |
            reg delete "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v AutoShareServer /f
            reg delete "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v AutoShareWks /f
        executor: command_prompt
