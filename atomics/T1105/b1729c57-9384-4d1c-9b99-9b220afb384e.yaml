api_version: "2.0"
name: Nimgrab - Transfer Files
description: "Use nimgrab.exe to download a file from the web. \n"
args:
    - name: remote_file
      type: string
      default: https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/LICENSE.txt
    - name: destination_path
      type: path
      default: $env:TEMP\Atomic-license.txt
uuid: b1729c57-9384-4d1c-9b99-9b220afb384e
mitre:
    tactics:
        - 'TA0011: Command and Control'
    techniques:
        - 'T1105: Ingress Tool Transfer'
requirements:
    platforms:
        - os: windows
steps:
    - name: |
        NimGrab must be installed on system.
      inline: |
        if (Test-Path "PathToAtomicsFolder\..\ExternalPayloads\nimgrab.exe") {exit 0} else {{New-Item -Type Directory "PathToAtomicsFolder\..\ExternalPayloads\" -ErrorAction Ignore -Force | Out-Null
        Invoke-WebRequest "https://nim-lang.org/download/nim-1.6.6_x64.zip" -Outfile "PathToAtomicsFolder\..\ExternalPayloads\nim.zip"
        Expand-Archive -Path "PathToAtomicsFolder\..\ExternalPayloads\nim.zip" -DestinationPath "PathToAtomicsFolder\..\ExternalPayloads\nim" -Force
        Copy-Item "PathToAtomicsFolder\..\ExternalPayloads\nim\nim-1.6.6\bin\nimgrab.exe" "PathToAtomicsFolder\..\ExternalPayloads\nimgrab.exe"
        }}
      executor: powershell
    - name: nimgrab---transfer-files
      inline: |
        cmd /c "PathToAtomicsFolder\..\ExternalPayloads\nimgrab.exe" {{.Args.remote_file}} {{.Args.destination_path}}
      executor: command_prompt
      cleanup:
        inline: |
            del {{.Args.destination_path}} >nul 2>&1
        executor: command_prompt
