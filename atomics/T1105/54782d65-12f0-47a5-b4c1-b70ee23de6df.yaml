api_version: "2.0"
name: Lolbas replace.exe use to copy file
description: |
    Copy file.cab to destination
    Reference: https://lolbas-project.github.io/lolbas/Binaries/Replace/
args:
    - name: replace_cab
      type: path
      default: PathToAtomicsFolder\T1105\src\redcanary.cab
    - name: Path_replace
      type: path
      default: C:\Windows\System32\replace.exe
uuid: 54782d65-12f0-47a5-b4c1-b70ee23de6df
mitre:
    tactics:
        - 'TA0011: Command and Control'
    techniques:
        - 'T1105: Ingress Tool Transfer'
requirements:
    platforms:
        - os: windows
steps:
    - name: |
        #{replace_cab} must exist on system.
      inline: |
        if (Test-Path "#{replace_cab}") {exit 0} else {{New-Item -Type Directory (split-path "#{replace_cab}") -ErrorAction ignore | Out-Null
        Invoke-WebRequest "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1105/src/redcanary.cab" -OutFile "#{replace_cab}"
        }}
      executor: powershell
    - name: lolbas-replace.exe-use-to-copy-file
      inline: |
        del %TEMP%\redcanary.cab >nul 2>&1
        {{.Args.Path_replace}} "{{.Args.replace_cab}}" %TEMP% /A
      executor: command_prompt
      cleanup:
        inline: |
            del %TEMP%\redcanary.cab >nul 2>&1
        executor: command_prompt
