api_version: "2.0"
name: Netcat C2
description: "Start C2 Session Using Ncat\nTo start the listener on a Linux device, type the following: \nnc -l -p <port>\n"
args:
    - name: server_port
      type: int
      default: "80"
    - name: ncat_exe
      type: path
      default: PathToAtomicsFolder\..\ExternalPayloads\T1095\nmap-7.80\ncat.exe
    - name: ncat_path
      type: path
      default: PathToAtomicsFolder\..\ExternalPayloads\T1095
    - name: server_ip
      type: string
      default: 127.0.0.1
uuid: bcf0d1c1-3f6a-4847-b1c9-7ed4ea321f37
mitre:
    tactics:
        - 'TA0011: Command and Control'
    techniques:
        - 'T1095: Non-Application Layer Protocol'
requirements:
    platforms:
        - os: windows
steps:
    - name: |
        ncat.exe must be available at specified location (#{ncat_exe})
      inline: |
        if( Test-Path "#{ncat_exe}") {exit 0} else {{[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        New-Item -ItemType Directory -Force -Path "#{ncat_path}" | Out-Null
        $parentpath = Split-Path (Split-Path "#{ncat_exe}"); $zippath = "$parentpath\nmap.zip"
        Invoke-WebRequest  "https://nmap.org/dist/nmap-7.80-win32.zip" -OutFile "$zippath"
          Expand-Archive $zippath $parentpath -Force
          $unzipPath = Join-Path $parentPath "nmap-7.80"
        if( $null -eq (Get-ItemProperty HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall\* | ?{$_.DisplayName -like "Microsoft Visual C++*"}) ) {
          Start-Process (Join-Path $unzipPath "vcredist_x86.exe")
        }
        }}
      executor: powershell
    - name: netcat-c2
      inline: |
        cmd /c "{{.Args.ncat_exe}}" {{.Args.server_ip}} {{.Args.server_port}}
      executor: powershell
      cleanup:
        inline: ""
        executor: powershell
