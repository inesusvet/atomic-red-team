api_version: "2.0"
name: Create and start VirtualBox virtual machine
description: |
    Create a simple VirtualBox VM and start up the machine
    Cleanup command stops and deletes the newly created VM and associated files
    https://www.virtualbox.org/manual/ch08.html#vboxmanage-startvm
    https://news.sophos.com/en-us/2020/05/21/ragnar-locker-ransomware-deploys-virtual-machine-to-dodge-security/
    https://attack.mitre.org/techniques/T1564/006/
args:
    - name: vm_name
      type: string
      default: Atomic VM
    - name: virtualbox_exe
      type: path
      default: C:\Program Files\Oracle\VirtualBox\VirtualBox.exe
    - name: vboxmanage_exe
      type: path
      default: C:\Program Files\Oracle\VirtualBox\VBoxManage.exe
    - name: virtualbox_download
      type: url
      default: https://download.virtualbox.org/virtualbox/6.1.32/VirtualBox-6.1.32-149290-Win.exe
    - name: virtualbox_installer
      type: string
      default: VirtualBox-6.1.32-149290-Win.exe
uuid: 88b81702-a1c0-49a9-95b2-2dd53d755767
mitre:
    tactics:
        - 'TA0005: Defense Evasion'
    techniques:
        - 'T1564: Hide Artifacts'
    subtechniques:
        - 'T1564.006: Run Virtual Instance'
requirements:
    platforms:
        - os: windows
steps:
    - name: create-and-start-virtualbox-virtual-machine
      inline: |
        "{{.Args.vboxmanage_exe}}" createvm --name "{{.Args.vm_name}}" --register
        "{{.Args.vboxmanage_exe}}" modifyvm "{{.Args.vm_name}}" --firmware efi
        "{{.Args.vboxmanage_exe}}" startvm "{{.Args.vm_name}}"
      executor: command_prompt
      cleanup:
        inline: |-
            "{{.Args.vboxmanage_exe}}" controlvm "{{.Args.vm_name}}" poweroff
            "{{.Args.vboxmanage_exe}}" unregistervm "{{.Args.vm_name}}" --delete
        executor: command_prompt
