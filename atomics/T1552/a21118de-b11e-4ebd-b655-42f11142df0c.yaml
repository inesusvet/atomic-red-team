api_version: "2.0"
name: AWS - Retrieve EC2 Password Data using stratus
description: |
    This atomic runs an API call GetPasswordData from a role that does not have permission to do so. This simulates an attacker attempting to retrieve RDP passwords on a high number of Windows EC2 instances. This atomic test leverages a tool called stratus-red-team built by DataDog (https://github.com/DataDog/stratus-red-team). Stratus Red Team is a self-contained binary. You can use it to easily detonate offensive attack techniques against a live cloud environment. Ref: https://stratus-red-team.cloud/attack-techniques/AWS/aws.credential-access.ec2-get-password-data/
args:
    - name: stratus_path
      type: path
      default: $PathToAtomicsFolder/T1552/src
    - name: aws_region
      type: string
      default: us-west-2
uuid: a21118de-b11e-4ebd-b655-42f11142df0c
mitre:
    tactics:
        - 'TA0006: Credential Access'
    techniques:
        - 'T1552: Unsecured Credentials'
requirements:
    platforms:
        - os: linux
        - os: macos
        - os: iaas:aws
steps:
    - name: aws---retrieve-ec2-password-data-using-stratus
      inline: "export AWS_REGION={{.Args.aws_region}} \ncd {{.Args.stratus_path}}\necho \"starting warmup\"\n./stratus warmup aws.credential-access.ec2-get-password-data\necho \"starting detonate\"\n./stratus detonate aws.credential-access.ec2-get-password-data --force\n"
      executor: sh
      cleanup:
        inline: |
            export AWS_REGION={{.Args.aws_region}}
            echo "Cleanup detonation"
            cd {{.Args.stratus_path}}
            ./stratus cleanup --all
            rm -rf stratus*
        executor: sh
