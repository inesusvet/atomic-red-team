api_version: "2.0"
name: Enable RDP via Registry (fDenyTSConnections)
description: "Modify the registry value of fDenyTSConnections to allow incoming RDP connections. \nThis activity has been observed by multiple ransomware groups, including Hive ransomware. \n[Reference](https://www.rapid7.com/blog/post/2023/01/11/increasing-the-sting-of-hive-ransomware/)\n"
args:
    - name: remove_rdp_access_during_cleanup
      type: int
      default: "0"
uuid: 16bdbe52-371c-4ccf-b708-79fba61f1db4
mitre:
    tactics:
        - 'TA0005: Defense Evasion'
    techniques:
        - 'T1112: Modify Registry'
requirements:
    platforms:
        - os: windows
steps:
    - name: enable-rdp-via-registry-(fdenytsconnections)
      inline: reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
      executor: command_prompt
      cleanup:
        inline: if {{.Args.remove_rdp_access_during_cleanup}} EQU 1 (reg delete "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /f >nul 2>&1)
        executor: command_prompt
