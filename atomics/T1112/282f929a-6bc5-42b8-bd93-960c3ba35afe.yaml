api_version: "2.0"
name: Modify Registry of Local Machine - cmd
description: |
    Modify the Local Machine registry RUN key to change Windows Defender executable that should be ran on startup.  This should only be possible when
    CMD is ran as Administrative rights. Upon execution, the message "The operation completed successfully."
    will be displayed. Additionally, open Registry Editor to view the modified entry in HKLM\Software\Microsoft\Windows\CurrentVersion\Run.
args:
    - name: new_executable
      type: string
      default: calc.exe
uuid: 282f929a-6bc5-42b8-bd93-960c3ba35afe
mitre:
    tactics:
        - 'TA0005: Defense Evasion'
    techniques:
        - 'T1112: Modify Registry'
requirements:
    platforms:
        - os: windows
steps:
    - name: modify-registry-of-local-machine---cmd
      inline: |
        reg add HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run /t REG_EXPAND_SZ /v SecurityHealth /d {{.Args.new_executable}} /f
      executor: command_prompt
      cleanup:
        inline: |
            reg delete HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run /v SecurityHealth /f >nul 2>&1
        executor: command_prompt
