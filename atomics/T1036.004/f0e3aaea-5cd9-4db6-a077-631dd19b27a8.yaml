api_version: "2.0"
name: linux rename /proc/pid/comm using prctl
description: |
    Runs a C program that calls prctl(PR_SET_NAME) to modify /proc/pid/comm value to "totally_legit".  This will show up as process name in simple 'ps' listings.
args:
    - name: exe_path
      type: path
      default: /tmp/T1036_004_prctl_rename
uuid: f0e3aaea-5cd9-4db6-a077-631dd19b27a8
mitre:
    tactics:
        - 'TA0005: Defense Evasion'
    techniques:
        - 'T1036: Masquerading'
    subtechniques:
        - 'T1036.004: Masquerade Task or Service'
requirements:
    platforms:
        - os: linux
steps:
    - name: |
        #{exe_path} must be exist on system.
      inline: |
        stat #{exe_path}
      executor: sh
    - name: linux-rename-/proc/pid/comm-using-prctl
      inline: |
        {{.Args.exe_path}} & ps
        TMP=`ps | grep totally_legit`
        if [ -z "${TMP}" ] ; then echo "renamed process NOT FOUND in process list" && exit 1; fi
        exit 0
      executor: sh
      cleanup:
        inline: |
            rm -f {{.Args.exe_path}}
        executor: sh
