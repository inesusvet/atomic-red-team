api_version: "2.0"
name: Launch DirLister Executable
description: |-
    Launches the DirLister executable for a short period of time and then exits.

    Recently seen used by [BlackCat ransomware](https://news.sophos.com/en-us/2022/07/14/blackcat-ransomware-attacks-not-merely-a-byproduct-of-bad-luck/) to create a list of accessible directories and files.
args:
    - name: dirlister_path
      type: string
      default: PathToAtomicsFolder\..\ExternalPayloads\DirLister.exe
uuid: c5bec457-43c9-4a18-9a24-fe151d8971b7
mitre:
    tactics:
        - 'TA0007: Discovery'
    techniques:
        - 'T1083: File and Directory Discovery'
requirements:
    platforms:
        - os: windows
steps:
    - name: |
        DirLister.exe must exist in the specified path #{dirlister_path}
      inline: |
        if (Test-Path "#{dirlister_path}") {exit 0} else {{$parentpath = Split-Path "#{dirlister_path}"
        New-Item -ItemType Directory -Force -Path $parentpath | Out-Null
        Invoke-WebRequest https://github.com/SanderSade/DirLister/releases/download/v2.beta4/DirLister.v2.beta4.zip -OutFile "PathToAtomicsFolder\..\ExternalPayloads\TDirLister.v2.beta4.zip"
        Expand-Archive -Path "PathToAtomicsFolder\..\ExternalPayloads\TDirLister.v2.beta4.zip" -DestinationPath "PathToAtomicsFolder\..\ExternalPayloads\TDirLister.v2.beta4" -Force
        Copy-Item "PathToAtomicsFolder\..\ExternalPayloads\TDirLister.v2.beta4\*" "$parentpath" -Recurse
        Remove-Item "PathToAtomicsFolder\..\ExternalPayloads\TDirLister.v2.beta4.zip","PathToAtomicsFolder\..\ExternalPayloads\TDirLister.v2.beta4" -Recurse -ErrorAction Ignore
        }}
      executor: powershell
    - name: launch-dirlister-executable
      inline: |
        Start-Process "{{.Args.dirlister_path}}"
        Start-Sleep -Second 4
        Stop-Process -Name "DirLister"
      executor: powershell
      cleanup:
        inline: ""
        executor: powershell
