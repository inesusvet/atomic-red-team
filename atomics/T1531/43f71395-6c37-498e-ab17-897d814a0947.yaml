api_version: "2.0"
name: Remove Account From Domain Admin Group
description: |
    This test will remove an account from the domain admins group
args:
    - name: super_user
      type: string
      default: domain\super_user
    - name: super_pass
      type: string
      default: password
    - name: remove_user
      type: string
      default: remove_user
uuid: 43f71395-6c37-498e-ab17-897d814a0947
mitre:
    tactics:
        - 'TA0040: Impact'
    techniques:
        - 'T1531: Account Access Removal'
requirements:
    platforms:
        - os: windows
steps:
    - name: remove-account-from-domain-admin-group
      inline: |
        $PWord = ConvertTo-SecureString -String {{.Args.super_pass}} -AsPlainText -Force
        $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList {{.Args.super_user}}, $PWord
        if((Get-ADUser {{.Args.remove_user}} -Properties memberof).memberof -like "CN=Domain Admins*"){
          Remove-ADGroupMember -Identity "Domain Admins" -Members {{.Args.remove_user}} -Credential $Credential -Confirm:$False
        } else{
            write-host "Error - Make sure {{.Args.remove_user}} is in the domain admins group" -foregroundcolor Red
        }
      executor: powershell
      cleanup:
        inline: ""
        executor: powershell
