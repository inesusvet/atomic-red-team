api_version: "2.0"
name: PowerShell Modify A Scheduled Task
description: "Create a scheduled task with an action and modify the action to do something else. The initial idea is to showcase Microsoft Windows TaskScheduler Operational log modification of an action on a Task already registered. \nIt will first be created to spawn cmd.exe, but modified to run notepad.exe.\n\nUpon successful execution, powershell.exe will create a scheduled task and modify the action. \n"
uuid: dda6fc7b-c9a6-4c18-b98d-95ec6542af6d
mitre:
    tactics:
        - 'TA0002: Execution'
        - 'TA0003: Persistence'
        - 'TA0004: Privilege Escalation'
    techniques:
        - 'T1053: Scheduled Task/Job'
    subtechniques:
        - 'T1053.005: Scheduled Task'
requirements:
    platforms:
        - os: windows
steps:
    - name: powershell-modify-a-scheduled-task
      inline: |
        $Action = New-ScheduledTaskAction -Execute "cmd.exe"
        $Trigger = New-ScheduledTaskTrigger -AtLogon
        $User = New-ScheduledTaskPrincipal -GroupId "BUILTIN\Administrators" -RunLevel Highest
        $Set = New-ScheduledTaskSettingsSet
        $object = New-ScheduledTask -Action $Action -Principal $User -Trigger $Trigger -Settings $Set
        Register-ScheduledTask AtomicTaskModifed -InputObject $object
        $NewAction = New-ScheduledTaskAction -Execute "Notepad.exe"
        Set-ScheduledTask "AtomicTaskModifed" -Action $NewAction
      executor: powershell
      cleanup:
        inline: |
            Unregister-ScheduledTask -TaskName "AtomicTaskModifed" -confirm:$false >$null 2>&1
        executor: powershell
