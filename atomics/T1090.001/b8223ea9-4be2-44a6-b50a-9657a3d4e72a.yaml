api_version: "2.0"
name: portproxy reg key
description: |
    Adds a registry key to set up a proxy on the endpoint at HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\PortProxy\v4tov4
    Upon execution there will be a new proxy entry in netsh
    netsh interface portproxy show all
args:
    - name: connectaddress
      type: string
      default: 127.0.0.1
    - name: connectport
      type: string
      default: "1337"
    - name: listenport
      type: string
      default: "1337"
uuid: b8223ea9-4be2-44a6-b50a-9657a3d4e72a
mitre:
    tactics:
        - 'TA0011: Command and Control'
    techniques:
        - 'T1090: Proxy'
    subtechniques:
        - 'T1090.001: Internal Proxy'
requirements:
    platforms:
        - os: windows
steps:
    - name: portproxy-reg-key
      inline: netsh interface portproxy add v4tov4 listenport={{.Args.listenport}} connectport={{.Args.connectport}} connectaddress={{.Args.connectaddress}}
      executor: powershell
      cleanup:
        inline: netsh interface portproxy delete v4tov4 listenport={{.Args.listenport}} -ErrorAction Ignore | Out-Null
        executor: powershell
