api_version: "2.0"
name: Pipe Creation - PsExec Tool Execution From Suspicious Locations
description: Requires PsExec tool installed. BlackCat Ransomeware tried to propagate by creating pipe using PsExec process executing from suspicious locations (In the particular case the legitimate PsExec executable is embedded within the Windows variant and is dropped in the victimâ€™s %TEMP% directory). pon successful execution, PsExec will be executed from suspicious location and create a new pipe to execute CMD.
uuid: 004a5d68-627b-452d-af3d-43bd1fc75a3b
mitre:
    tactics:
        - 'TA0002: Execution'
    techniques:
        - 'T1569: System Services'
    subtechniques:
        - 'T1569.002: Service Execution'
requirements:
    platforms:
        - os: windows
steps:
    - name: |
        PsExec tool from Sysinternals must exist in the '\Users\Public\Temp\' directory
      inline: |
        if (Get-ChildItem -Path C:\ -Include *psexec* -File -Recurse -ErrorAction SilentlyContinue) {exit 0} else {{New-Item -Type Directory "C:\Users\Public\Temp\" -ErrorAction Ignore -Force | Out-Null
        Invoke-WebRequest "https://download.sysinternals.com/files/PSTools.zip" -OutFile "C:\Users\Public\Temp\PSTools.zip"
        Expand-Archive "C:\Users\Public\Temp\PsTools.zip" "C:\Users\Public\Temp\" -Force
        }}
      executor: powershell
    - name: pipe-creation---psexec-tool-execution-from-suspicious-locations
      inline: "cd C:\\Users\\Public\\Temp\\ \n.\\PsExec.exe -i -s cmd  -accepteula"
      executor: powershell
      cleanup:
        inline: ""
        executor: powershell
