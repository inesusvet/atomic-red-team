api_version: "2.0"
name: DNS over HTTPS Regular Beaconing
description: |
    This test simulates an infected host beaconing via DoH queries to a command and control server at regular intervals over time.
    This behaviour is typical of implants either in an idle state waiting for instructions or configured to use a low query volume over time to evade threshold based detection.
    A custom domain and sub-domain will need to be passed as input parameters for this test to work. Upon execution, DNS information about the domain will be displayed for each callout in a JSON format.
args:
    - name: doh_server
      type: string
      default: https://8.8.8.8/resolve
    - name: runtime
      type: int
      default: "30"
    - name: domain
      type: string
      default: 127.0.0.1.xip.io
    - name: subdomain
      type: string
      default: atomicredteam
    - name: query_type
      type: string
      default: TXT
    - name: c2_interval
      type: int
      default: "30"
    - name: c2_jitter
      type: int
      default: "20"
uuid: 0c5f9705-c575-42a6-9609-cbbff4b2fc9b
mitre:
    tactics:
        - 'TA0011: Command and Control'
    techniques:
        - 'T1572: Protocol Tunneling'
requirements:
    platforms:
        - os: windows
steps:
    - name: dns-over-https-regular-beaconing
      inline: |
        Set-Location "PathToAtomicsFolder"
        .\T1572\src\T1572-doh-beacon.ps1 -DohServer {{.Args.doh_server}} -Domain {{.Args.domain}} -Subdomain {{.Args.subdomain}} -QueryType {{.Args.query_type}} -C2Interval {{.Args.c2_interval}} -C2Jitter {{.Args.c2_jitter}} -RunTime {{.Args.runtime}}
      executor: powershell
      cleanup:
        inline: ""
        executor: powershell
