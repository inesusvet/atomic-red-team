api_version: "2.0"
name: System Owner/User Discovery
description: "Identify System owner or users on an endpoint.\n\nUpon successful execution, cmd.exe will spawn multiple commands against a target host to identify usernames. Output will be via stdout. \nAdditionally, two files will be written to disk - computers.txt and usernames.txt.\n"
args:
    - name: computer_name
      type: string
      default: localhost
uuid: 4c4959bf-addf-4b4a-be86-8d09cc1857aa
mitre:
    tactics:
        - 'TA0007: Discovery'
    techniques:
        - 'T1033: System Owner/User Discovery'
requirements:
    platforms:
        - os: windows
steps:
    - name: system-owner/user-discovery
      inline: |
        cmd.exe /C whoami
        wmic useraccount get /ALL
        quser /SERVER:"{{.Args.computer_name}}"
        quser
        qwinsta.exe /server:{{.Args.computer_name}}
        qwinsta.exe
        for /F "tokens=1,2" %i in ('qwinsta /server:{{.Args.computer_name}} ^| findstr "Active Disc"') do @echo %i | find /v "#" | find /v "console" || echo %j > computers.txt
        @FOR /F %n in (computers.txt) DO @FOR /F "tokens=1,2" %i in ('qwinsta /server:%n ^| findstr "Active Disc"') do @echo %i | find /v "#" | find /v "console" || echo %j > usernames.txt
      executor: command_prompt
      cleanup:
        inline: ""
        executor: command_prompt
