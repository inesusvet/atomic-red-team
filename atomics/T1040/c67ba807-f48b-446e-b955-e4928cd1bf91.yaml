api_version: "2.0"
name: Windows Internal pktmon capture
description: |-
    Will start a packet capture and store log file as t1040.etl.
    https://lolbas-project.github.io/lolbas/Binaries/Pktmon/
uuid: c67ba807-f48b-446e-b955-e4928cd1bf91
mitre:
    tactics:
        - 'TA0006: Credential Access'
        - 'TA0007: Discovery'
    techniques:
        - 'T1040: Network Sniffing'
requirements:
    platforms:
        - os: windows
steps:
    - name: windows-internal-pktmon-capture
      inline: |
        pktmon.exe start --etw  -f %TEMP%\t1040.etl
        TIMEOUT /T 5 >nul 2>&1
        pktmon.exe stop
      executor: command_prompt
      cleanup:
        inline: del %TEMP%\t1040.etl
        executor: command_prompt
