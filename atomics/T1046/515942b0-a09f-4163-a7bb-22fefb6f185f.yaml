api_version: "2.0"
name: Port Scan Nmap
description: |
    Scan ports to check for listening ports with Nmap.
    Upon successful execution, sh will utilize nmap, telnet, and nc to contact a single or range of addresses on port 80 to determine if listening. Results will be via stdout.
args:
    - name: host
      type: string
      default: 192.168.1.1
    - name: port
      type: string
      default: "80"
    - name: network_range
      type: string
      default: 192.168.1.0/24
uuid: 515942b0-a09f-4163-a7bb-22fefb6f185f
mitre:
    tactics:
        - 'TA0007: Discovery'
    techniques:
        - 'T1046: Network Service Discovery'
requirements:
    platforms:
        - os: linux
        - os: darwin
steps:
    - name: |
        Check if nmap command exists on the machine
      inline: |
        if [ -x "$(command -v nmap)" ]; then exit 0; else {(which yum && yum -y install epel-release nmap)||(which apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y nmap)||(which pkg && pkg install -y nmap)
        }; fi;
      executor: sh
    - name: |
        Check if nc command exists on the machine
      inline: |
        if [ -x "$(command -v nc)" ]; then exit 0; else {(which yum && yum -y install epel-release nc)||(which apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y netcat)||(which pkg && pkg install -y netcat)
        }; fi;
      executor: sh
    - name: |
        Check if telnet command exists on the machine
      inline: |
        if [ -x "$(command -v telnet)" ]; then exit 0; else {(which yum && yum -y install epel-release telnet)||(which apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y telnet)
        }; fi;
      executor: sh
    - name: port-scan-nmap
      inline: |
        sudo nmap -sS {{.Args.network_range}} -p {{.Args.port}}
        telnet {{.Args.host}} {{.Args.port}}
        nc -nv {{.Args.host}} {{.Args.port}}
      executor: sh
      cleanup:
        inline: ""
        executor: sh
