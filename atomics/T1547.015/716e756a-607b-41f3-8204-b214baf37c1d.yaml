api_version: "2.0"
name: Add macOS LoginItem using Applescript
description: |
    Runs osascript on a file to create new LoginItem for current user.
    NOTE: Will popup dialog prompting user to Allow or Deny Terminal.app to control "System Events"
    Therefore, it can't be automated until the TCC is granted.
    The login item launches Safari.app when user logs in, but there is a cleanup script to remove it as well.
    In addition to the `osascript` Process Events, file modification events to
    `/Users/*/Library/Application Support/com.apple.backgroundtaskmanagementagent/backgrounditems.btm` should be seen.
args:
    - name: scriptfile
      type: string
      default: PathToAtomicsFolder/T1547.015/src/add_login_item.osa
    - name: cleanup_script
      type: string
      default: PathToAtomicsFolder/T1547.015/src/remove_login_item.osa
uuid: 716e756a-607b-41f3-8204-b214baf37c1d
mitre:
    tactics:
        - 'TA0003: Persistence'
        - 'TA0004: Privilege Escalation'
    techniques:
        - 'T1547: Boot or Logon Autostart Execution'
    subtechniques:
        - 'T1547.015: Login Items'
requirements:
    platforms:
        - os: darwin
steps:
    - name: add-macos-loginitem-using-applescript
      inline: |
        osascript {{.Args.scriptfile}}
      executor: bash
      cleanup:
        inline: |
            osascript {{.Args.cleanup_script}}
        executor: bash
