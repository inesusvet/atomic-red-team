api_version: "2.0"
name: Login as nobody (freebsd)
description: |
    An adversary may try to re-purpose a system account to appear legitimate. In this test change the login shell of the nobody account, change its password to nobody, su to nobody, exit, then reset nobody's shell to /usr/sbin/nologin. Here is how the nobody entry should look like in `/etc/passwd` before the test is executed and right after the cleanup: `# -> nobody:x:65534:65534:Unprivileged user:/nonexistent:/usr/sbin/nologin`
uuid: 16f6374f-7600-459a-9b16-6a88fd96d310
mitre:
    tactics:
        - 'TA0005: Defense Evasion'
        - 'TA0003: Persistence'
        - 'TA0004: Privilege Escalation'
        - 'TA0001: Initial Access'
    techniques:
        - 'T1078: Valid Accounts'
    subtechniques:
        - 'T1078.003: Local Accounts'
requirements:
    platforms:
        - os: linux
steps:
    - name: login-as-nobody-(freebsd)
      inline: |
        cat /etc/passwd |grep nobody
        pw usermod nobody -s /bin/sh
        echo $(openssl passwd -1 art) | pw mod user nobody -h 0
        su nobody
        whoami
        exit
      executor: sh
      cleanup:
        inline: |
            pw usermod nobody -s /usr/sbin/nologin
            cat /etc/passwd |grep nobody
            # -> nobody:*:65534:65534:Unprivileged user:/nonexistent:/usr/sbin/nologin
        executor: sh
