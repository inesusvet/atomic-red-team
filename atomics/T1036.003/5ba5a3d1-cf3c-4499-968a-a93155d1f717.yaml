api_version: "2.0"
name: Masquerading as Windows LSASS process
description: |
    Copies cmd.exe, renames it, and launches it to masquerade as an instance of lsass.exe.

    Upon execution, cmd will be launched by powershell. If using Invoke-AtomicTest, The test will hang until the 120 second timeout cancels the session
uuid: 5ba5a3d1-cf3c-4499-968a-a93155d1f717
mitre:
    tactics:
        - 'TA0005: Defense Evasion'
    techniques:
        - 'T1036: Masquerading'
    subtechniques:
        - 'T1036.003: Rename System Utilities'
requirements:
    platforms:
        - os: windows
steps:
    - name: masquerading-as-windows-lsass-process
      inline: |
        copy %SystemRoot%\System32\cmd.exe %SystemRoot%\Temp\lsass.exe
        %SystemRoot%\Temp\lsass.exe /B
      executor: command_prompt
      cleanup:
        inline: |
            del /Q /F %SystemRoot%\Temp\lsass.exe >nul 2>&1
        executor: command_prompt
