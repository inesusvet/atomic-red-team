api_version: "2.0"
name: Launch Daemon
description: |
    Utilize LaunchDaemon to launch `Hello World`
args:
    - name: plist_filename
      type: string
      default: com.atomicredteam.plist
    - name: path_malicious_plist
      type: string
      default: $PathToAtomicsFolder/T1543.004/src/atomicredteam_T1543_004.plist
uuid: 03ab8df5-3a6b-4417-b6bd-bb7a5cfd74cf
mitre:
    tactics:
        - 'TA0003: Persistence'
        - 'TA0004: Privilege Escalation'
    techniques:
        - 'T1543: Create or Modify System Process'
    subtechniques:
        - 'T1543.004: Launch Daemon'
requirements:
    platforms:
        - os: darwin
steps:
    - name: |
        The shared library must exist on disk at specified location (#{path_malicious_plist})
      inline: |
        if [ -f #{path_malicious_plist} ]; then exit 0; else {echo "The plist file doesn't exist. Check the path and try again."; exit 1;
        }; fi;
      executor: bash
    - name: launch-daemon
      inline: |
        sudo cp {{.Args.path_malicious_plist}} /Library/LaunchDaemons/{{.Args.plist_filename}}
        sudo launchctl load -w /Library/LaunchDaemons/{{.Args.plist_filename}}
      executor: bash
      cleanup:
        inline: |
            sudo launchctl unload /Library/LaunchDaemons/{{.Args.plist_filename}}
            sudo rm /Library/LaunchDaemons/{{.Args.plist_filename}}
            sudo rm /tmp/T1543_004_atomicredteam.txt
        executor: bash
