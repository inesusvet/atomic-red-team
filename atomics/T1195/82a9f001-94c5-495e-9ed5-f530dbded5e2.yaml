api_version: "2.0"
name: Octopus Scanner Malware Open Source Supply Chain
description: |
    This test simulates an adversary Octopus drop the RAT dropper ExplorerSync.db
    [octopus-scanner-malware-open-source-supply-chain](https://securitylab.github.com/research/octopus-scanner-malware-open-source-supply-chain/)
    [the-supreme-backdoor-factory](https://www.dfir.it/blog/2019/02/26/the-supreme-backdoor-factory/)
args:
    - name: rat_payload
      type: path
      default: $env:TEMP\ExplorerSync.db
uuid: 82a9f001-94c5-495e-9ed5-f530dbded5e2
mitre:
    tactics:
        - 'TA0001: Initial Access'
    techniques:
        - 'T1195: Supply Chain Compromise'
requirements:
    platforms:
        - os: windows
steps:
    - name: |
        ExplorerSync.db must exist on disk at specified location (#{rat_payload})
      inline: |
        if (Test-Path #{rat_payload}) {exit 0} else {{Out-File -FilePath "#{rat_payload}"
        }}
      executor: powershell
    - name: octopus-scanner-malware-open-source-supply-chain
      inline: |
        copy %temp%\ExplorerSync.db %temp%\..\Microsoft\ExplorerSync.db
        schtasks /create /tn ExplorerSync /tr "javaw -jar %temp%\..\Microsoft\ExplorerSync.db" /sc MINUTE /f
      executor: command_prompt
      cleanup:
        inline: |
            schtasks /delete /tn ExplorerSync /F 2>null
            del %temp%\..\Microsoft\ExplorerSync.db 2>null
            del %temp%\ExplorerSync.db 2>null
        executor: command_prompt
