api_version: "2.0"
name: Suspicious Execution via Windows Command Shell
description: |
    Command line executed via suspicious invocation. Example is from the 2021 Threat Detection Report by Red Canary.
args:
    - name: output_file
      type: string
      default: hello.txt
    - name: input_message
      type: string
      default: Hello, from CMD!
uuid: d0eb3597-a1b3-4d65-b33b-2cda8d397f20
mitre:
    tactics:
        - 'TA0002: Execution'
    techniques:
        - 'T1059: Command and Scripting Interpreter'
    subtechniques:
        - 'T1059.003: Windows Command Shell'
requirements:
    platforms:
        - os: windows
steps:
    - name: suspicious-execution-via-windows-command-shell
      inline: |
        %LOCALAPPDATA:~-3,1%md /c echo {{.Args.input_message}} > {{.Args.output_file}} & type {{.Args.output_file}}
      executor: command_prompt
      cleanup:
        inline: ""
        executor: command_prompt
