api_version: "2.0"
name: Azure - Eventhub Deletion
description: |
    Identifies an Event Hub deletion in Azure.
    An Event Hub is an event processing service that ingests and processes large volumes of events and data.
    An adversary may delete an Event Hub in an attempt to evade detection.
    https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-about.
args:
    - name: event_hub_name
      type: string
      default: test_eventhub
    - name: resource_group
      type: string
      default: <nil>
    - name: name_space_name
      type: string
      default: <nil>
    - name: username
      type: string
      default: <nil>
    - name: password
      type: string
      default: <nil>
uuid: 5e09bed0-7d33-453b-9bf3-caea32bff719
mitre:
    tactics:
        - 'TA0005: Defense Evasion'
    techniques:
        - 'T1562: Impair Defenses'
    subtechniques:
        - 'T1562.008: Disable or Modify Cloud Logs'
requirements:
    platforms:
        - os: iaas:azure
steps:
    - name: azure---eventhub-deletion
      inline: |
        $secure_pwd = "{{.Args.password}}" | ConvertTo-SecureString -AsPlainText -Force
        $creds = New-Object System.Management.Automation.PSCredential -ArgumentList "{{.Args.username}}", $secure_pwd
        Connect-AzureAD -Credential $creds
        Remove-AzEventHub -ResourceGroupName {{.Args.resource_group}} -Namespace {{.Args.name_space_name}} -Name {{.Args.event_hub_name}}
      executor: powershell
      cleanup:
        inline: |
            cd "$PathToAtomicsFolder/T1562.008/src/T1562.008-2/"
            terraform destroy -auto-approve
        executor: powershell
