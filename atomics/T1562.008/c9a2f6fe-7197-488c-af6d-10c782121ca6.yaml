api_version: "2.0"
name: Office 365 - Set Audit Bypass For a Mailbox
description: |
    Use Exchange Management Shell to Mailbox auditing to bypass. It will prevent any mailbox audit logging entries being generated for the target e-mail box.
    https://learn.microsoft.com/en-us/powershell/module/exchange/set-mailboxauditbypassassociation?view=exchange-ps
args:
    - name: username
      type: string
      default: o365_user_test
    - name: password
      type: string
      default: o365_password_test
    - name: target_email
      type: string
      default: o365_email_test
uuid: c9a2f6fe-7197-488c-af6d-10c782121ca6
mitre:
    tactics:
        - 'TA0005: Defense Evasion'
    techniques:
        - 'T1562: Impair Defenses'
    subtechniques:
        - 'T1562.008: Disable or Modify Cloud Logs'
requirements:
    platforms:
        - os: office-365
steps:
    - name: office-365---set-audit-bypass-for-a-mailbox
      inline: |
        $secure_pwd = "{{.Args.password}}" | ConvertTo-SecureString -AsPlainText -Force
        $creds = New-Object System.Management.Automation.PSCredential -ArgumentList "{{.Args.username}}", $secure_pwd
        Connect-ExchangeOnline -Credential $creds
        Set-MailboxAuditBypassAssociation -Identity "{{.Args.target_email}}" -AuditBypassEnabled $true
      executor: powershell
      cleanup:
        inline: |
            $secure_pwd = "{{.Args.password}}" | ConvertTo-SecureString -AsPlainText -Force
            $creds = New-Object System.Management.Automation.PSCredential -ArgumentList "{{.Args.username}}", $secure_pwd
            Connect-ExchangeOnline -Credential $creds
            Set-MailboxAuditBypassAssociation -Identity "{{.Args.target_email}}" -AuditBypassEnabled $false
            Disconnect-ExchangeOnline -Confirm:$false
        executor: powershell
